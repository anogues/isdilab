
USE ROLE ACCOUNTADMIN;
CREATE DATABASE IF NOT EXISTS LAB_DB; -- si no usamos terraform

CREATE SCHEMA IF NOT EXISTS LAB_DB.BRONZE; -- si no usamos terraform

USE DATABASE LAB_DB;

USE SCHEMA BRONZE;

CREATE STAGE IF NOT EXISTS LAB_DB.BRONZE.INTERNAL_CUSTOMER_STAGE; -- si no usamos terraform

CREATE ROLE IF NOT EXISTS TRANSFORMER;

GRANT ROLE TRANSFORMER TO ROLE SYSADMIN;

CREATE WAREHOUSE IF NOT EXISTS DBT_LAB_WH WAREHOUSE_SIZE = 'XSMALL' AUTO_SUSPEND = 60 AUTO_RESUME = TRUE INITIALLY_SUSPENDED = TRUE;

GRANT USAGE ON WAREHOUSE DBT_LAB_WH TO ROLE TRANSFORMER;

GRANT USAGE ON DATABASE LAB_DB TO ROLE TRANSFORMER;

GRANT USAGE ON SCHEMA LAB_DB.bronze TO ROLE TRANSFORMER; -- A schema 'bronze'

GRANT USAGE ON STAGE LAB_DB.bronze.INTERNAL_CUSTOMER_STAGE TO ROLE TRANSFORMER;

GRANT CREATE SCHEMA ON DATABASE LAB_DB TO ROLE TRANSFORMER; -- Para crear schemas de destino

CREATE USER IF NOT EXISTS DBT_USER PASSWORD = 'xxxxx' LOGIN_NAME = 'DBT_USER' DEFAULT_WAREHOUSE = 'DBT_LAB_WH' DEFAULT_ROLE = 'TRANSFORMER' MUST_CHANGE_PASSWORD = FALSE;

GRANT ROLE TRANSFORMER TO USER DBT_USER;

GRANT CREATE TABLE ON FUTURE SCHEMAS IN DATABASE LAB_DB TO ROLE TRANSFORMER;

GRANT CREATE VIEW ON FUTURE SCHEMAS IN DATABASE LAB_DB TO ROLE TRANSFORMER;
